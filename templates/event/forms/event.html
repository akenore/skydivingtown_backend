{% extends "public/secure/components/base.html" %}
{% load static i18n %}
{% block title %}
    {% if object %}
        {% translate "Update event" %}
    {% else %}
        {% translate "Add event" %}
    {% endif %}
{% endblock title %}
{% block head %}
    <script src="https://unpkg.com/htmx.org@2.0.4"></script>
{% endblock head %}
{% block nav %}
    {% include "public/secure/components/header.html" %}
{% endblock nav %}
{% block aside %}
    {% include "public/secure/components/sidebar.html" %}
{% endblock aside %}
{% block body %}
    <div class="md:p-4 sm:ml-64">
        <div class="mx-auto max-w-screen-2xl p-4 md:p-6 2xl:p-10 dark:text-gray-300">
            <div class="shadow-md sm:rounded-lg p-8">
                <form method="post">
                    {% csrf_token %}
                    {% for field in form %}
                        <div class="mb-4">
                            <label for="{{ field.id_for_label }}"
                                   class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                {{ field.label }}
                            </label>
                            {{ field }}
                            {% if field.errors %}
                                <div class="text-red-500">
                                    {% for error in field.errors %}<strong>{{ error|escape }}</strong>{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    {% endfor %}
                    <div class="w-full px-2 bg-amber-300 dark:bg-amber-900 mb-2 rounded-t-lg">
                        <h3 class="text-lg font-medium text-gray-900 dark:text-white py-1">{% translate "Event Dates" %}</h3>
                    </div>
                    <div id="event-dates">
                        {{ eventdate_formset.management_form }}
                        {% for event_date_form in eventdate_formset.forms %}
                            <div id="event-date-{{ forloop.counter0 }}">
                                {% include "event/forms/partials/event_date_form.html" with form=event_date_form date_index=forloop.counter0 %}
                            </div>
                        {% endfor %}
                    </div>
                    <button type="button"
                            id="add-event-date"
                            class="px-3 py-2 text-xs font-medium text-center text-white bg-blue-700 rounded-lg hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
                            hx-get="{% url 'add_event_date_form' %}"
                            hx-target="#event-dates"
                            hx-swap="beforeend"
                            hx-vals='js:{"index": document.querySelectorAll("#event-dates > div").length}'>
                        {% translate "Add event date" %}
                    </button>
                    <div class="flex justify-center pt-8">
                        <button class="w-2/4 text-white bg-gradient-to-br from-purple-600 to-blue-500 hover:bg-gradient-to-bl focus:ring-4 focus:outline-none focus:ring-blue-300 dark:focus:ring-blue-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2"
                                type="submit">
                            {% if object %}
                                {% translate "Update" %}
                            {% else %}
                                {% translate "Add" %}
                            {% endif %}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock body %}
{% block scripts %}
    <script>
        document.body.addEventListener('htmx:configRequest', (event) => {
            event.detail.headers['X-CSRFToken'] = '{{ csrf_token }}';
        });
    </script>
{% endblock scripts %}
